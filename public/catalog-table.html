<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rubineta – katalogo lentelė</title>
  <style>
    body { margin: 0; background: #fff; color: #111; font: 13px/1.4 Arial, sans-serif; }
    header, main { max-width: 100%; margin: 0 auto; padding: 10px; }
    h1 { margin: 8px 0 12px; font-size: 18px; }

    .controls { display: grid; grid-template-columns: repeat(12, 1fr); gap: 8px; align-items: end; margin-bottom: 10px; }
    .controls .field { grid-column: span 3; min-width: 160px; }
    .controls .field.sm { grid-column: span 2; min-width: 120px; }
    .controls label { display: block; font-size: 11px; color: #333; margin-bottom: 2px; }
    .controls input, .controls select { width: 100%; padding: 4px 6px; font-size: 12px; }
    .controls .actions { display:flex; gap:6px; align-items:center; grid-column: 1 / -1; flex-wrap: wrap; }
    .controls button { padding: 6px 10px; font-size: 12px; cursor: pointer; }
    .muted { color: #666; }
    .status { margin-left: 6px; }

    table { width: 100%; border-collapse: collapse; font-size: 12px; table-layout: fixed; }
    thead th { background: #eee; border: 1px solid #ccc; padding: 4px; text-align: left; cursor: pointer; user-select: none; }
    thead th.nosort { cursor: default; }
    thead th .arrow{ font-size: 10px; opacity:.7; margin-left:4px }
    tbody td { border: 1px solid #ccc; padding: 4px; vertical-align: top; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    tbody tr:nth-child(even) { background: #fafafa; }
    tbody tr:hover { background: #f3f6ff; }

    .thumb { width: 40px; height: 40px; object-fit: cover; cursor: pointer; background:#f0f0f0 }
    .sku { font-family: monospace; font-size: 11px; color: #333; }
    .badge { display: inline-block; padding: 2px 4px; margin: 1px; background: #f0f0f0; border: 1px solid #ccc; font-size: 10px; }
    .error { color: #b00; margin: 6px 0; white-space: pre-wrap; }

    .pagination { display: flex; justify-content: center; gap: 6px; margin: 15px 0; flex-wrap: wrap; }
    .pagination button { padding: 6px 10px; font-size: 12px; cursor: pointer; border: 1px solid #ccc; background: #fff; }
    .pagination button.active { background: #007cba; color: white; border-color: #007cba; }
    .pagination button:disabled { color: #ccc; cursor: not-allowed; }
    .dots { padding: 6px 8px; color:#888 }
  </style>

  <!-- SheetJS biblioteka XLSX generavimui -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.20.2/dist/xlsx.full.min.js"></script>
</head>
<body>
  <header>
    <h1>Rubineta – katalogo lentelė</h1>
    <div class="controls">
      <div class="field" style="grid-column: span 4;">
        <label>Paieška (SKU arba pavadinimas)</label>
        <input id="q" type="search" placeholder="pvz., 710016 arba 'maišytuvas'"/>
      </div>
      <div class="field">
        <label>Kategorija</label>
        <select id="cat"><option value="">Visos</option></select>
      </div>
      <div class="field">
        <label>Serija</label>
        <select id="series"><option value="">Visos</option></select>
      </div>
      <div class="field sm">
        <label>Per puslapį</label>
        <input id="per" type="number" value="25" min="10" max="100"/>
      </div>
      <div class="field sm"><label><input type="checkbox" id="onlyDocs"/> Tik su dokumentais</label></div>
      <div class="field sm"><label><input type="checkbox" id="onlyVideo"/> Tik su video</label></div>
      <div class="field sm"><label><input type="checkbox" id="onlyGuide"/> Turi remonto gidą</label></div>
      <div class="actions">
        <button id="load">Įkelti</button>
        <button id="exportCsv">Eksportuoti CSV</button>
        <button id="exportXls">Eksportuoti Excel (XLSX)</button>
        <span id="status" class="status muted"></span>
      </div>
    </div>
  </header>

  <main>
    <div id="alert" class="error"></div>

    <table id="tbl" aria-live="polite">
      <thead>
        <tr>
          <th class="nosort" style="width:56px">Nuotrauka</th>
          <th data-sort="name" style="width:24%">Pavadinimas <span class="arrow"></span></th>
          <th data-sort="sku" style="width:12%">SKU <span class="arrow"></span></th>
          <th data-sort="cats" style="width:22%">Kategorijos <span class="arrow"></span></th>
          <th data-sort="series" style="width:12%">Serija <span class="arrow"></span></th>
          <th data-sort="warranty" style="width:8%">Garantija <span class="arrow"></span></th>
          <th data-sort="conn" style="width:8%">Jungtis <span class="arrow"></span></th>
          <th data-sort="color" style="width:8%">Spalva <span class="arrow"></span></th>
          <th data-sort="finish" style="width:10%">Padengimas <span class="arrow"></span></th>
          <th data-sort="upd" style="width:10%">Atnaujinta <span class="arrow"></span></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="pagination" id="pagination"></div>
  </main>

  <script>
    const $ = (s, el = document) => el.querySelector(s);
    let allProducts = [], filtered = [];
    let currentPage = 1, sortKey = 'name', sortDir = 'asc';

    /* Paprasta escape funkcija */
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

    /* Demo duomenys (vietoje /api) */
    async function loadPage(){
      allProducts = [
        {sku:"710016", name:"Click-Clack 1 1/4", categories:[{name:"Sifonai"}], attributes:[], date_modified:"2024-05-01"},
        {sku:"664129", name:"Eco Ceramic Cross", categories:[{name:"Dalys"}], attributes:[], date_modified:"2024-06-12"}
      ];
      filtered = allProducts;
      updateView();
    }

    function renderTable(products){
      const tbody = $('#tbl tbody'); tbody.innerHTML='';
      products.forEach(p=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td></td>
          <td>${escapeHtml(p.name||'')}</td>
          <td>${escapeHtml(p.sku||'')}</td>
          <td>${(p.categories||[]).map(c=>escapeHtml(c.name)).join(', ')}</td>
          <td></td><td></td><td></td><td></td><td></td>
          <td>${escapeHtml(p.date_modified||'')}</td>`;
        tbody.append(tr);
      });
    }

    function renderPagination(){
      const perPage=parseInt($('#per').value||'25',10);
      const totalPages=Math.ceil(filtered.length/perPage);
      const pagination=$('#pagination'); pagination.innerHTML='';
      if(totalPages<=1) return;
      for(let i=1;i<=totalPages;i++){
        const btn=document.createElement('button');
        btn.textContent=i;
        if(i===currentPage) btn.classList.add('active');
        btn.onclick=()=>{ currentPage=i; updateView(); };
        pagination.append(btn);
      }
    }

    function updateView(){
      const perPage=parseInt($('#per').value||'25',10);
      const start=(currentPage-1)*perPage, end=start+perPage;
      renderTable(filtered.slice(start,end)); renderPagination();
      $('#status').textContent=`Rasta: ${filtered.length}`;
    }

    /* Eksportai */
    function rowsForExport(){
      return filtered.map(p=>({
        Pavadinimas: p.name||'', SKU: p.sku||'',
        Kategorijos: (p.categories||[]).map(c=>c.name).join(', '),
        Atnaujinta: p.date_modified||''
      }));
    }

    function downloadBlob(name, blob){
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob); a.download=name;
      document.body.appendChild(a); a.click();
      setTimeout(()=>{URL.revokeObjectURL(a.href); a.remove();},0);
    }

    function exportCSV(){
      const rows=rowsForExport();
      const headers=Object.keys(rows[0]||{});
      const esc=v=>`"${String(v??'').replace(/"/g,'""')}"`;
      const csv=[headers.map(esc).join(',')].concat(
        rows.map(r=>headers.map(h=>esc(r[h])).join(','))
      ).join('\r\n');
      downloadBlob('rubineta_export.csv', new Blob([csv], {type:'text/csv;charset=utf-8'}));
    }

    function exportXLSX(){
      if (typeof XLSX === 'undefined') {
        alert('Nepavyko įkelti XLSX bibliotekos.');
        return;
      }
      const rows = rowsForExport();
      const ws = XLSX.utils.json_to_sheet(rows);

      // automatiniai pločiai
      const headers = Object.keys(rows[0] || {});
      ws['!cols'] = headers.map(h=>{
        const maxLen = Math.max(
          h.length,
          ...rows.map(r=>String(r[h]??'').length)
        );
        return {wch:Math.min(Math.max(maxLen+2,10),50)};
      });

      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Rubineta');
      const fname = `rubineta_export_${new Date().toISOString().slice(0,10)}.xlsx`;
      XLSX.writeFile(wb, fname);
    }

    $('#load').onclick=loadPage;
    $('#exportCsv').onclick=exportCSV;
    $('#exportXls').onclick=exportXLSX;

    window.onload = loadPage;
  </script>
</body>
</html>





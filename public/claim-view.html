<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pretenzija #ID</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2D2D2D;
            --light: #F5F5F5;
            --white: #FFFFFF;
            --gray: #75757d;
            --font: 'Roboto', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font);
            background: var(--light);
            color: #333;
            font-size: 12px;
            line-height: 1.4;
        }
        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .section {
            background: var(--white);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            border: 1px solid #eee;
        }
        .section h3 {
            font-size: 13px;
            color: var(--primary);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .section h3::before {
            content: "";
            display: inline-block;
            width: 6px;
            height: 6px;
            background: var(--primary);
            border-radius: 50%;
            margin-right: 6px;
        }
        .field {
            margin-bottom: 6px;
            word-break: break-word;
        }
        .field-label {
            font-weight: 500;
            color: #555;
            min-width: 100px;
            display: inline-block;
        }
        .file-item {
            font-size: 11px;
            margin: 3px 0;
            word-break: break-all;
        }
        .file-item a {
            color: #17a2b8;
            text-decoration: none;
        }
        .file-item a:hover {
            text-decoration: underline;
        }
        .file-item img, .file-item video {
            margin-top: 5px;
            border-radius: 4px;
            max-width: 100%;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--gray);
            font-size: 11px;
            padding: 20px;
            border-top: 1px solid #ddd;
        }
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        /* Veiksmų istorija */
        .timeline {
            margin-top: 10px;
            padding-left: 10px;
            position: relative;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 5px;
            top: 5px;
            bottom: 5px;
            width: 2px;
            background: #ccc;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 10px;
            padding-left: 20px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 3px;
            top: 8px;
            width: 6px;
            height: 6px;
            background: #17a2b8;
            border-radius: 50%;
        }
        .timeline-item small {
            color: #777;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Kairė pusė -->
        <div class="left-column">
            <div class="section">
                <h3>1. Pagrindinė informacija</h3>
                <div class="field"><span class="field-label">ID:</span> <span id="claim-id"></span></div>
                <div class="field"><span class="field-label">Data:</span> <span id="claim-date"></span></div>
                <div class="field"><span class="field-label">Tema:</span> <span id="claim-topic"></span></div>
                <div class="field"><span class="field-label">Veiklos tipas:</span> <span id="claim-role"></span></div>
                <div class="field"><span class="field-label">Produktas:</span> <span id="claim-product"></span></div>
                <div class="field"><span class="field-label">Aprašymas:</span> <span id="claim-description"></span></div>
                <div class="field"><span class="field-label">Kliento reikalavimas:</span> <span id="claim-request"></span></div>
            </div>

            <div class="section">
                <h3>2. Kontaktiniai duomenys</h3>
                <div class="field"><span class="field-label">Vardas:</span> <span id="contact-name"></span></div>
                <div class="field"><span class="field-label">Pavardė:</span> <span id="contact-surname"></span></div>
                <div class="field"><span class="field-label">El. paštas:</span> <span id="contact-email"></span></div>
                <div class="field"><span class="field-label">Telefonas:</span> <span id="contact-phone"></span></div>
                <div class="field"><span class="field-label">Adresas:</span> <span id="contact-address"></span></div>
                <div class="field"><span class="field-label">Miestas:</span> <span id="contact-city"></span></div>
                <div class="field"><span class="field-label">Pašto kodas:</span> <span id="contact-postal"></span></div>
                <div class="field"><span class="field-label">Pageidaujamas kontaktas:</span> <span id="contact-method"></span></div>
                <div class="field"><span class="field-label">Patogus laikas:</span> <span id="preferred-time"></span></div>
            </div>

            <div class="section">
                <h3>3. Vartotojo prisegti dokumentai</h3>
                <div id="user-files"></div>
            </div>
        </div>

        <!-- Dešinė pusė -->
        <div class="right-column">
            <div class="section">
                <h3>4. Kokybės skyriaus komentarai</h3>
                <p id="quality-note">Nėra papildomų pastabų.</p>
            </div>

            <div class="section">
                <h3>5. Atsakingas asmuo</h3>
                <div class="field"><span class="field-label">Vardas:</span> <span id="responsible-name"></span></div>
                <div class="field"><span class="field-label">Pavardė:</span> <span id="responsible-surname"></span></div>
                <div class="field"><span class="field-label">Pareigos:</span> <span id="responsible-role"></span></div>
                <div class="field"><span class="field-label">El. paštas:</span> <span id="responsible-email"></span></div>
                <div class="field"><span class="field-label">Telefonas:</span> <span id="responsible-phone"></span></div>
            </div>

            <div class="section">
                <h3>6. Priskirtas partneris</h3>
                <div class="field"><span class="field-label">Pavadinimas:</span> <span id="partner-name"></span></div>
            </div>

            <div class="section">
                <h3>7. Būsena</h3>
                <div class="field"><span class="field-label">Būsena:</span> <span id="claim-status"></span></div>
            </div>

            <div class="section">
                <h3>8. Veiksmų istorija</h3>
                <div id="timeline-container" class="timeline"></div>
            </div>

<div class="section">
    <h3>9. Kokybės skyriaus dokumentai</h3>
    <div id="quality-attachments"></div>
</div>




        </div>
    </div>

    <footer>© 2025 Rubineta. Visos teisės saugomos. | info@rubineta.lt</footer>

    <script>
        // Gauti ID iš URL
        const urlParams = new URLSearchParams(window.location.search);
        const claimId = urlParams.get('id');

        if (!claimId) {
            alert('Nenurodytas pretenzijos ID.');
            history.back();
        }

        // Rasti pretenziją
        const claims = JSON.parse(localStorage.getItem('claims') || '[]');
        const claim = claims.find(c => c.id === claimId);

        if (!claim) {
            alert('Pretenzija nerasta.');
            history.back();
        }

        // --- Užpildyti pagrindinę informaciją ---
        document.getElementById('claim-id').textContent = claim.id;
        document.getElementById('claim-date').textContent = new Date(claim.date).toLocaleString('lt-LT');
        document.getElementById('claim-topic').textContent = claim.topic;
        document.getElementById('claim-role').textContent = claim.role;
        document.getElementById('claim-product').textContent = claim.product;
        document.getElementById('claim-description').textContent = claim.description;
        document.getElementById('claim-request').textContent = claim.request;

        // --- Kontaktiniai duomenys ---
        document.getElementById('contact-name').textContent = claim.contact.name;
        document.getElementById('contact-surname').textContent = claim.contact.surname;
        document.getElementById('contact-email').textContent = claim.contact.email;
        document.getElementById('contact-phone').textContent = claim.contact.phone;
        document.getElementById('contact-address').textContent = claim.contact.street;
        document.getElementById('contact-city').textContent = claim.contact.city;
        document.getElementById('contact-postal').textContent = claim.contact.postal;
        document.getElementById('contact-method').textContent = claim.contactMethod;
        document.getElementById('preferred-time').textContent = claim.preferredTime;

// Rodyti kokybės skyriaus dokumentus
const qualityAttachmentsContainer = document.getElementById('quality-attachments');
if (claim.qualityAttachments && claim.qualityAttachments.length > 0) {
    claim.qualityAttachments.forEach(att => {
        const item = document.createElement('div');
        item.className = 'attachment-item';
        item.style.margin = '8px 0';
        item.style.padding = '8px';
        item.style.border = '1px solid #ddd';
        item.style.borderRadius = '6px';
        item.style.backgroundColor = '#f9f9f9';

        let link = '';
        if (att.type === 'video') {
            link = `<a href="${att.url}" target="_blank" style="color:#17a2b8;">🎬 Peržiūrėti video</a>`;
        } else if (att.type === 'link') {
            link = `<a href="${att.url}" target="_blank" style="color:#17a2b8;">🔗 Atidaryti nuorodą</a>`;
        } else {
            link = `<a href="${att.url}" target="_blank" style="color:#17a2b8;">📎 Atsisiųsti dokumentą</a>`;
        }

        item.innerHTML = `
            <strong>${att.name}</strong><br>
            ${link}
        `;
        qualityAttachmentsContainer.appendChild(item);
    });
} else {
    qualityAttachmentsContainer.innerHTML = '<p>Nėra papildomų dokumentų nuo kokybės skyriaus.</p>';
}




        // --- Vartotojo failai ---
        const userFilesContainer = document.getElementById('user-files');
        let userFilesHtml = '';
        if (Array.isArray(claim.files) && claim.files.length > 0) {
            claim.files.forEach(url => {
                if (typeof url !== 'string') return;
                if (url.includes('/video/')) {
                    userFilesHtml += `<div class="file-item"><video controls src="${url}" style="max-width:100%"></video></div>`;
                } else if (url.endsWith('.pdf')) {
                    userFilesHtml += `<div class="file-item"><a href="${url}?dl=1" target="_blank">📄 ${url.split('/').pop()}</a></div>`;
                } else {
                    userFilesHtml += `<div class="file-item"><img src="${url}" style="max-width:100%;border-radius:4px"></div>`;
                }
            });
        } else {
            userFilesHtml = '<div class="file-item">Nėra įkeltų failų</div>';
        }
        userFilesContainer.innerHTML = userFilesHtml;

        // --- Kokybės komentaras ---
        document.getElementById('quality-note').textContent = claim.qualityComment || 'Nėra papildomų pastabų.';

        // --- Atsakingas asmuo ---
        if (claim.responsible) {
            const [name, surname] = claim.responsible.split(' ');
            document.getElementById('responsible-name').textContent = name || '';
            document.getElementById('responsible-surname').textContent = surname || '';
        }

        // --- Priskirtas partneris ---
        document.getElementById('partner-name').textContent = claim.assignedPartner || 'Nėra';

        // --- Būsena ---
        document.getElementById('claim-status').textContent = claim.status;

        // --- Veiksmų istorija ---
        const timeline = document.getElementById('timeline-container');
        timeline.innerHTML = '';
        const historyEvents = [
            { user: 'Sistema', time: claim.date, action: 'Pretenzija pateikta' },
            { user: claim.responsible || 'Kokybės skyrius', time: claim.date, action: `Būsena: ${claim.status}` },
            { user: claim.assignedPartner || 'Sistema', time: claim.date, action: claim.assignedPartner ? `Priskirta partneriui` : 'Laukia priskyrimo' }
        ];
        historyEvents.forEach(event => {
            const item = document.createElement('div');
            item.className = 'timeline-item';
            item.innerHTML = `
                <strong>${event.user}</strong>
                <small>${new Date(event.time).toLocaleString('lt-LT')}</small>
                <div>${event.action}</div>
            `;
            timeline.appendChild(item);
        });
    </script>
</body>
</html>

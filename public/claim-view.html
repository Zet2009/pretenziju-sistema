<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pretenzija #ID</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2D2D2D;
            --light: #F5F5F5;
            --white: #FFFFFF;
            --gray: #75757d;
            --font: 'Roboto', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font);
            background: var(--light);
            color: #333;
            font-size: 12px;
            line-height: 1.4;
        }
        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .section {
            background: var(--white);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            border: 1px solid #eee;
        }
.section h3 {
    font-size: 13px;
    color: var(--primary);
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid #eee;
    display: flex;
    align-items: center;
    gap: 6px;
}
.section h3::before {
    content: "";
    display: inline-block;
    width: 6px;
    height: 6px;
    background: var(--primary);
    border-radius: 50%;
    margin-right: 6px;
}
        .field {
            margin-bottom: 6px;
            word-break: break-word;
        }
        .field-label {
            font-weight: 500;
            color: #555;
            min-width: 100px;
            display: inline-block;
        }
        .file-item {
            font-size: 11px;
            margin: 3px 0;
            word-break: break-all;
        }
        .file-item a {
            color: #17a2b8;
            text-decoration: none;
        }
        .file-item a:hover {
            text-decoration: underline;
        }
        .file-item img, .file-item video {
            margin-top: 5px;
            border-radius: 4px;
            max-width: 100%;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--gray);
            font-size: 11px;
            padding: 20px;
            border-top: 1px solid #ddd;
        }
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        /* Veiksm≈≥ istorija */
        .timeline {
            margin-top: 10px;
            padding-left: 10px;
            position: relative;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 5px;
            top: 5px;
            bottom: 5px;
            width: 2px;
            background: #ccc;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 10px;
            padding-left: 20px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 3px;
            top: 8px;
            width: 6px;
            height: 6px;
            background: #17a2b8;
            border-radius: 50%;
        }
        .timeline-item small {
            color: #777;
            font-size: 10px;
        }
    </style>

<style>
/* === zen-chat scoped styles === */
.zen-chat-thread{border:1px solid #e5e7eb;border-radius:10px;padding:10px;max-height:280px;overflow:auto;background:#fff}
.zen-chat-row{margin:8px 0;display:flex}
.zen-chat-bubble{max-width:78%;border:1px solid #e5e7eb;padding:8px 10px;border-radius:12px;background:#f8fafc}
.zen-chat-row.zen-right{justify-content:flex-end}
.zen-bubble-admin{background:#e8f5e9}
.zen-bubble-user{background:#e8f0fe}
.zen-bubble-master{background:#fff3cd}
.zen-chat-meta{font-size:11px;color:#6b7280;margin-bottom:4px}
.zen-chat-files{margin-top:6px;font-size:12px}
.zen-chat-input{display:flex;gap:8px;margin-top:8px;align-items:center}
.zen-pill{display:inline-block;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:999px;padding:2px 8px;font-size:12px;color:#4b5563}
.zen-muted{color:#6b7280;font-size:14px}
.zen-section{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;margin:12px 0}
</style>

<script>
// === zen-chat utils (namespaced) ===
(function(){
  if (window.ZenChat) return; // singleton
  window.ZenChat = {
    getClaims: function(){ try{return JSON.parse(localStorage.getItem('claims')||'[]')}catch(_){return []} },
    setClaims: function(arr){ localStorage.setItem('claims', JSON.stringify(arr)); },
    fmt: function(ts){ try{return new Date(ts).toLocaleString('lt-LT')}catch(_){return ts} },
    icon: function(name){
      const n=(name||'').toLowerCase();
      if(/\.(jpg|jpeg|png|webp|gif)$/.test(n)) return 'üñºÔ∏è';
      if(/\.(mp4|webm|mov)$/.test(n)) return 'üé•';
      if(/\.(pdf)$/.test(n)) return 'üìÑ';
      return 'üìé';
    },
    legacyToNew: function(m){
      if(m && m.from && m.to) return m;
      if(!m) return m;
      if(m.author==='quality') return {from:'admin', to:'user', text:m.text, files:m.attachments||[], time:m.time, id:m.id};
      if(m.author==='customer') return {from:'user', to:'admin', text:m.text, files:m.attachments||[], time:m.time, id:m.id};
      if(m.author==='master') return {from:'master', to:'admin', text:m.text, files:m.attachments||[], time:m.time, id:m.id};
      return m;
    },
uploadFiles: async function(fileList) {
  const out = [];
  for (const file of fileList) {
    const arrayBuffer = await file.arrayBuffer();
    const base64Data = btoa(
      new Uint8Array(arrayBuffer).reduce(
        (data, byte) => data + String.fromCharCode(byte),
        ''
      )
    );
    const mimeType = file.type || 'application/octet-stream';
    const dataUrl = `data:${mimeType};base64,${base64Data}`;
    out.push({
      name: file.name,
      dataUrl: dataUrl, // Saugome base64 formatu
      type: /\.(jpg|jpeg|png|webp|gif)$/i.test(file.name)
        ? 'image'
        : /\.(mp4|webm|mov)$/i.test(file.name)
          ? 'video'
          : /\.(pdf)$/i.test(file.name)
            ? 'pdf'
            : 'file'
    });
  }
  return out;
},
    renderThread: function(container, list, perspective){
      if(!list.length){ container.innerHTML='<div class="zen-muted">Nƒóra ≈æinuƒçi≈≥</div>'; return; }
      container.innerHTML = list.map(m=>{
        const side = (m.from===perspective)?'zen-right':'';
        const bubbleClass = m.from==='admin'?'zen-bubble-admin':(m.from==='user'?'zen-bubble-user':'zen-bubble-master');
        const files = (m.files || []).map(f => {
  const link = f.dataUrl || f.url; // Naudojam dataUrl, jei yra
  if (f.type === 'image') {
    return `<div><img src="${link}" alt="${f.name}" style="max-width:100%;border-radius:4px;margin:5px 0"></div>`;
  } else if (f.type === 'video') {
    return `<div><video controls style="max-width:100%"><source src="${link}">Nar≈°yklƒó nepalaiko video.</video></div>`;
  } else if (f.type === 'pdf') {
    return `<div><a href="${link}" target="_blank" download="${f.name}">üìÑ ${f.name}</a></div>`;
  } else {
    return `<div><a href="${link}" target="_blank" download="${f.name}">${ZenChat.icon(f.name)} ${f.name}</a></div>`;
  }
}).join('');
        return `<div class="zen-chat-row ${side}">
          <div class="zen-chat-bubble ${bubbleClass}">
            <div class="zen-chat-meta">${m.from} ‚Üí ${m.to} ‚Ä¢ <small>${ZenChat.fmt(m.time)}</small></div>
            <div style="white-space:pre-wrap">${(m.text||'')}</div>
            ${files?`<div class="zen-chat-files">${files}</div>`:''}
          </div>
        </div>`;
      }).join('');
      container.scrollTop = container.scrollHeight;
    }
  };
})();
</script>
</head>
<body>
    <div class="container">
        <!-- Kairƒó pusƒó -->
        <div class="left-column">
            <div class="section">
                <h3>1. Pagrindinƒó informacija</h3>
                <div class="field"><span class="field-label">ID:</span> <span id="claim-id"></span></div>
                <div class="field"><span class="field-label">Data:</span> <span id="claim-date"></span></div>
                <div class="field"><span class="field-label">Tema:</span> <span id="claim-topic"></span></div>
                <div class="field"><span class="field-label">Veiklos tipas:</span> <span id="claim-role"></span></div>
                <div class="field"><span class="field-label">Produktas:</span> <span id="claim-product"></span></div>
                <div class="field"><span class="field-label">Apra≈°ymas:</span> <span id="claim-description"></span></div>
                <div class="field"><span class="field-label">Kliento reikalavimas:</span> <span id="claim-request"></span></div>
            </div>

            <div class="section">
                <h3>2. Kontaktiniai duomenys</h3>
                <div class="field"><span class="field-label">Vardas:</span> <span id="contact-name"></span></div>
                <div class="field"><span class="field-label">Pavardƒó:</span> <span id="contact-surname"></span></div>
                <div class="field"><span class="field-label">El. pa≈°tas:</span> <span id="contact-email"></span></div>
                <div class="field"><span class="field-label">Telefonas:</span> <span id="contact-phone"></span></div>
                <div class="field"><span class="field-label">Adresas:</span> <span id="contact-address"></span></div>
                <div class="field"><span class="field-label">Miestas:</span> <span id="contact-city"></span></div>
                <div class="field"><span class="field-label">Pa≈°to kodas:</span> <span id="contact-postal"></span></div>
                <div class="field"><span class="field-label">Pageidaujamas kontaktas:</span> <span id="contact-method"></span></div>
                <div class="field"><span class="field-label">Patogus laikas:</span> <span id="preferred-time"></span></div>
            </div>

<div class="section">
    <h3>3. Pirkimo dokumentas</h3>
    <div id="purchase-document"></div>
</div>

            <div class="section">
                <h3>4. Vartotojo prisegti dokumentai</h3>
                <div id="user-files"></div>
            </div>
        </div>



        <!-- De≈°inƒó pusƒó -->
        <div class="right-column">
            <div class="section">
                <h3>5. Kokybƒós skyriaus komentarai</h3>
                <p id="quality-note">Nƒóra papildom≈≥ pastab≈≥.</p>
            </div>

            <div class="section">
                <h3>6. Atsakingas asmuo</h3>
                <div class="field"><span class="field-label">Vardas:</span> <span id="responsible-name"></span></div>
                <div class="field"><span class="field-label">Pavardƒó:</span> <span id="responsible-surname"></span></div>
                <div class="field"><span class="field-label">Pareigos:</span> <span id="responsible-role"></span></div>
                <div class="field"><span class="field-label">El. pa≈°tas:</span> <span id="responsible-email"></span></div>
                <div class="field"><span class="field-label">Telefonas:</span> <span id="responsible-phone"></span></div>
            </div>

            <div class="section">
                <h3>7. Priskirtas partneris</h3>
                <div class="field"><span class="field-label">Pavadinimas:</span> <span id="partner-name"></span></div>
            </div>

            <div class="section">
                <h3>8. B≈´sena</h3>
                <div class="field"><span class="field-label">B≈´sena:</span> <span id="claim-status"></span></div>
            </div>

            <div class="section">
                <h3>9. Veiksm≈≥ istorija</h3>
                <div id="timeline-container" class="timeline"></div>
            </div>

<div class="section">
    <h3>10. Kokybƒós skyriaus dokumentai</h3>
    <div id="quality-attachments"></div>
</div>




        </div>
    </div>

       <script>
        // Gauti ID i≈° URL
        const urlParams = new URLSearchParams(window.location.search);
        const claimId = urlParams.get('id');

        if (!claimId) {
            alert('Nenurodytas pretenzijos ID.');
            history.back();
        }

        // Rasti pretenzijƒÖ
        const claims = JSON.parse(localStorage.getItem('claims') || '[]');
        const claim = claims.find(c => c.id === claimId);

        if (!claim) {
            alert('Pretenzija nerasta.');
            history.back();
        }

        // --- U≈æpildyti pagrindinƒô informacijƒÖ ---
        document.getElementById('claim-id').textContent = claim.id;
        document.getElementById('claim-date').textContent = new Date(claim.date).toLocaleString('lt-LT');
        document.getElementById('claim-topic').textContent = claim.topic;
        document.getElementById('claim-role').textContent = claim.role;
        document.getElementById('claim-product').textContent = claim.product;
        document.getElementById('claim-description').textContent = claim.description;
        document.getElementById('claim-request').textContent = claim.request;

        // --- Kontaktiniai duomenys ---
        document.getElementById('contact-name').textContent = claim.contact.name;
        document.getElementById('contact-surname').textContent = claim.contact.surname;
        document.getElementById('contact-email').textContent = claim.contact.email;
        document.getElementById('contact-phone').textContent = claim.contact.phone;
        document.getElementById('contact-address').textContent = claim.contact.street;
        document.getElementById('contact-city').textContent = claim.contact.city;
        document.getElementById('contact-postal').textContent = claim.contact.postal;
        document.getElementById('contact-method').textContent = claim.contactMethod;
        document.getElementById('preferred-time').textContent = claim.preferredTime;



// --- Pirkimo dokumentas ---
const purchaseDocContainer = document.getElementById('purchase-document');
if (claim.purchaseDocument) {
    const url = claim.purchaseDocument;

    if (url.match(/\.(jpg|jpeg|png|webp)$/i)) {
        purchaseDocContainer.innerHTML = `<img src="${url}" alt="Pirkimo dokumentas" style="max-width:100%; border-radius:6px;">`;
    } else if (url.match(/\.(mp4|webm)$/i)) {
        purchaseDocContainer.innerHTML = `<video controls style="max-width:100%;"><source src="${url}" type="video/mp4">Nar≈°yklƒó nepalaiko video.</video>`;
    } else if (url.match(/\.(pdf)$/i)) {
        purchaseDocContainer.innerHTML = `<a href="${url}" target="_blank" style="color:#d44646;">üìÑ Atidaryti pirkimo dokumentƒÖ (PDF)</a>`;
    } else {
        purchaseDocContainer.innerHTML = `<a href="${url}" target="_blank" style="color:#17a2b8;">üìé Atsisi≈≥sti dokumentƒÖ</a>`;
    }
} else {
    purchaseDocContainer.innerHTML = '<p style="color:#dc3545;">Pirkimo dokumentas nerastas. Klientas jo neƒØkƒólƒó.</p>';
}


// Rodyti kokybƒós skyriaus dokumentus
// --- Kokybƒós skyriaus dokumentai ---
const qualityAttachmentsContainer = document.getElementById('quality-attachments');
qualityAttachmentsContainer.innerHTML = '';

if (claim.qualityAttachments && claim.qualityAttachments.length > 0) {
    claim.qualityAttachments.forEach(att => {
        const item = document.createElement('div');
        item.className = 'file-item';
        item.style.margin = '8px 0';
        item.style.padding = '8px';
        item.style.border = '1px solid #ddd';
        item.style.borderRadius = '6px';
        item.style.backgroundColor = '#f9f9f9';
        item.style.textAlign = 'center';

        if (att.type === 'file') {
            const url = att.url;
            const name = att.name;

            if (url.match(/\.(jpg|jpeg|png|webp)$/i)) {
                item.innerHTML = `
                    <strong>${name}</strong><br>
                    <img src="${url}" alt="${name}" style="max-width:100%; border-radius:4px; margin:4px 0;">
                `;
            } else if (url.match(/\.(mp4|webm)$/i)) {
                item.innerHTML = `
                    <strong>${name}</strong><br>
                    <video controls style="max-width:100%;">
                        <source src="${url}" type="video/mp4">
                        J≈´s≈≥ nar≈°yklƒó nepalaiko video.
                    </video>
                `;
            } else if (url.match(/\.(pdf)$/i)) {
                item.innerHTML = `
                    <strong>${name}</strong><br>
                    <a href="${url}" target="_blank" style="color:#d44646;">üìÑ Atidaryti PDF</a>
                `;
            } else {
                item.innerHTML = `
                    <strong>${name}</strong><br>
                    <a href="${url}" target="_blank" style="color:#17a2b8;">üìé Atsisi≈≥sti dokumentƒÖ</a>
                `;
            }
        } else if (att.type === 'video') {
            item.innerHTML = `
                <strong>${att.name}</strong><br>
                <a href="${att.url}" target="_blank" style="color:#17a2b8;">üé¨ Per≈æi≈´rƒóti video</a>
            `;
        } else if (att.type === 'link') {
            item.innerHTML = `
                <strong>${att.name}</strong><br>
                <a href="${att.url}" target="_blank" style="color:#17a2b8;">üîó Atidaryti nuorodƒÖ</a>
            `;
        }

        qualityAttachmentsContainer.appendChild(item);
    });
} else {
    qualityAttachmentsContainer.innerHTML = '<p>Nƒóra prisegt≈≥ dokument≈≥ nuo kokybƒós skyriaus.</p>';
}




        // --- Vartotojo failai ---
        const userFilesContainer = document.getElementById('user-files');
        let userFilesHtml = '';
        if (Array.isArray(claim.files) && claim.files.length > 0) {
            claim.files.forEach(url => {
                if (typeof url !== 'string') return;
                if (url.includes('/video/')) {
                    userFilesHtml += `<div class="file-item"><video controls src="${url}" style="max-width:100%"></video></div>`;
                } else if (url.endsWith('.pdf')) {
                    userFilesHtml += `<div class="file-item"><a href="${url}?dl=1" target="_blank">üìÑ ${url.split('/').pop()}</a></div>`;
                } else {
                    userFilesHtml += `<div class="file-item"><img src="${url}" style="max-width:100%;border-radius:4px"></div>`;
                }
            });
        } else {
            userFilesHtml = '<div class="file-item">Nƒóra ƒØkelt≈≥ fail≈≥</div>';
        }
       
       
       
        userFilesContainer.innerHTML = userFilesHtml;



        

        // --- Kokybƒós komentaras ---
        document.getElementById('quality-note').textContent = claim.qualityExternalComment || 'Nƒóra papildom≈≥ pastab≈≥.';

        // --- Atsakingas asmuo ---
        if (claim.responsible) {
            const [name, surname] = claim.responsible.split(' ');
            document.getElementById('responsible-name').textContent = name || '';
            document.getElementById('responsible-surname').textContent = surname || '';
        }

        // --- Priskirtas partneris ---
        document.getElementById('partner-name').textContent = claim.assignedPartner || 'Nƒóra';

        // --- B≈´sena ---
        document.getElementById('claim-status').textContent = claim.status;

        // --- Veiksm≈≥ istorija ---
// --- Veiksm≈≥ istorija ---
const timeline = document.getElementById('timeline-container');
timeline.innerHTML = '';

// Pagrindiniai ƒØvykiai
const baseHistory = [
    { user: 'Sistema', time: claim.date, action: 'Pretenzija pateikta' }
];




if (claim.status !== 'Nauja') {
    baseHistory.push({
        user: claim.responsible || 'Kokybƒós skyrius',
        time: claim.date,
        action: `B≈´sena: ${claim.status}`
    });
}

if (claim.assignedPartner) {
    baseHistory.push({
        user: claim.assignedPartner,
        time: claim.date,
        action: 'Priskirta serviso partneriui'
    });
}

// Pridƒók istorijƒÖ i≈° localStorage (jei yra)
const fullHistory = [...baseHistory];

if (Array.isArray(claim.history)) {
    fullHistory.push(...claim.history);
}

// R≈´≈°iuok chronologi≈°kai
fullHistory.sort((a, b) => new Date(a.time) - new Date(b.time));

// Atvaizduok
fullHistory.forEach(event => {
    const item = document.createElement('div');
    item.className = 'timeline-item';
    item.innerHTML = `
        <strong>${event.user}</strong>
        <small>${new Date(event.time).toLocaleString('lt-LT')}</small>
        <div>${event.action}</div>
    `;
    timeline.appendChild(item);
});
        historyEvents.forEach(event => {
            const item = document.createElement('div');
            item.className = 'timeline-item';
            item.innerHTML = `
                <strong>${event.user}</strong>
                <small>${new Date(event.time).toLocaleString('lt-LT')}</small>
                <div>${event.action}</div>
            `;
            timeline.appendChild(item);
        });


        
    </script>



<!-- === zen-chat: Admin chats (grupuoti konteineriu) === -->
<div class="container">
    <div id="zen-chat-user" class="section" style="margin-bottom: 0;">
        <h3>11. Susira≈°inƒójimas su vartotoju</h3>
        <div id="zen-chat-user-thread" class="zen-chat-thread"></div>
        <div class="zen-chat-input">
            <input id="zen-chat-user-input" placeholder="Atsakyti vartotojui‚Ä¶" style="flex:1;padding:10px">
            <input id="zen-chat-user-files" type="file" multiple>
            <button id="zen-chat-user-send">Si≈≥sti</button>
        </div>
        <div id="zen-chat-user-files-preview" class="zen-muted"></div>
    </div>

    <div id="zen-chat-master" class="section" style="margin-bottom: 0;">
        <h3>12. Susira≈°inƒójimas su meistru</h3>
        <div id="zen-chat-master-thread" class="zen-chat-thread"></div>
        <div class="zen-chat-input">
            <input id="zen-chat-master-input" placeholder="≈Ωinutƒó meistrui‚Ä¶" style="flex:1;padding:10px">
            <input id="zen-chat-master-files" type="file" multiple>
            <button id="zen-chat-master-send">Si≈≥sti</button>
        </div>
        <div id="zen-chat-master-files-preview" class="zen-muted"></div>
    </div>
</div>

<footer>¬© 2025 Rubineta. Visos teisƒós saugomos. | hello@rubineta.com</footer>
<script>
// === zen-chat: Admin page wiring ===
(function(){
  const params=new URLSearchParams(location.search); const id=params.get('id');
  let claims=ZenChat.getClaims(); let claim=claims.find(c=>c.id===id) || claims[0];
  if(!claim) return;

  if(Array.isArray(claim.messages)){ claim.messages = claim.messages.map(ZenChat.legacyToNew); ZenChat.setClaims(claims); }

  // USER <-> ADMIN
  const uThread=document.getElementById('zen-chat-user-thread');
  const uInput=document.getElementById('zen-chat-user-input');
  const uFiles=document.getElementById('zen-chat-user-files');
  const uPrev=document.getElementById('zen-chat-user-files-preview');
  function drawU(){
    const fresh=ZenChat.getClaims().find(x=>x.id===claim.id); if(!fresh) return; claim=fresh;
    const msgs=(claim.messages||[]).filter(m=> (m.from==='user'&&m.to==='admin')||(m.from==='admin'&&m.to==='user'));
    ZenChat.renderThread(uThread, msgs, 'admin');
  }
  uFiles.addEventListener('change', ()=>{ uPrev.textContent=[...uFiles.files].map(f=>f.name).join(', '); });
  document.getElementById('zen-chat-user-send').addEventListener('click', async ()=>{
    const text=(uInput.value||'').trim(); const uploaded=await ZenChat.uploadFiles(uFiles.files);
    if(!text && uploaded.length===0) return;
    const all=ZenChat.getClaims(); const c=all.find(x=>x.id===claim.id); if(!c) return;
    if(!Array.isArray(c.messages)) c.messages=[];
    c.messages.push({ id:'msg_'+Math.random().toString(36).slice(2), from:'admin', to:'user', text, files:uploaded, time:new Date().toISOString() });
    ZenChat.setClaims(all); uInput.value=''; uFiles.value=''; uPrev.textContent=''; drawU();
  });
  drawU();

  // MASTER <-> ADMIN
  const mThread=document.getElementById('zen-chat-master-thread');
  const mInput=document.getElementById('zen-chat-master-input');
  const mFiles=document.getElementById('zen-chat-master-files');
  const mPrev=document.getElementById('zen-chat-master-files-preview');
  function drawM(){
    const fresh=ZenChat.getClaims().find(x=>x.id===claim.id); if(!fresh) return; claim=fresh;
    const msgs=(claim.messages||[]).filter(m=> (m.from==='master'&&m.to==='admin')||(m.from==='admin'&&m.to==='master'));
    ZenChat.renderThread(mThread, msgs, 'admin');
  }
  mFiles.addEventListener('change', ()=>{ mPrev.textContent=[...mFiles.files].map(f=>f.name).join(', '); });
  document.getElementById('zen-chat-master-send').addEventListener('click', async ()=>{
    const text=(mInput.value||'').trim(); const uploaded=await ZenChat.uploadFiles(mFiles.files);
    if(!text && uploaded.length===0) return;
    const all=ZenChat.getClaims(); const c=all.find(x=>x.id===claim.id); if(!c) return;
    if(!Array.isArray(c.messages)) c.messages=[];
    c.messages.push({ id:'msg_'+Math.random().toString(36).slice(2), from:'admin', to:'master', text, files:uploaded, time:new Date().toISOString() });
    ZenChat.setClaims(all); mInput.value=''; mFiles.value=''; mPrev.textContent=''; drawM();
  });
  drawM();
})();
</script>

</body>
</html>

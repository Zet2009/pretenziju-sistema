<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keisti slaptažodį – Rubineta</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2D2D2D;
            --primary-light: #4A4A4A;
            --primary-hover: #6B6B6B;
            --secondary: #FFCC00;
            --light: #F5F5F5;
            --dark: #212121;
            --white: #FFFFFF;
            --gray: #757575;
            --font: 'Roboto', 'Arial', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font);
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }
        header {
            background: var(--white);
            padding: 15px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { height: 50px; cursor: pointer; }
        nav a {
            margin: 0 15px;
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            font-size: 16px;
        }
        .language-selector {
            position: relative;
            display: inline-block;
        }
        .language-btn {
            background: var(--primary-light);
            color: var(--white);
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .language-btn:hover {
            background: var(--primary-hover);
        }
        .language-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: var(--white);
            min-width: 140px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
            z-index: 101;
        }
        .language-dropdown.show {
            display: block;
        }
        .language-option {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
        }
        .language-option:hover {
            background: var(--light);
        }
        .language-flag {
            width: 24px;
            height: 18px;
            object-fit: cover;
            border: 1px solid #ddd;
        }
        .container {
            max-width: 400px;
            margin: 50px auto;
            background: var(--white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }
        .error {
            color: #d32f2f;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #ffebee;
            border-radius: 4px;
            border-left: 4px solid #d32f2f;
        }
        .success {
            color: #2e7d32;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #e8f5e9;
            border-radius: 4px;
            border-left: 4px solid #2e7d32;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
            transition: border 0.3s;
        }
        input:focus {
            border-color: var(--primary);
            outline: none;
        }
        button {
            width: 100%;
            padding: 14px;
            background: var(--primary-light);
            color: var(--white);
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        button:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        footer {
            text-align: center;
            margin-top: 60px;
            padding: 20px;
            color: var(--gray);
            font-size: 12px;
            border-top: 1px solid #dee2e6;
            background: var(--secondary);
        }
        .footer-flags {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }
        .footer-flag {
            width: 30px;
            height: 20px;
            object-fit: cover;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .footer-flag:hover {
            transform: scale(1.1);
        }
        .success a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        .success a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <img src="logo.jpg" alt="Rubineta Logo" class="logo" onclick="location.href='index.html'">
        <nav>
            <a href="index.html" data-translate="nav-home">Pagrindinis</a>
            <a href="login.html" data-translate="nav-login">Prisijungti</a>
        </nav>
        <div class="language-selector">
            <button class="language-btn" id="language-btn">
                <img src="LT.png" alt="LT" class="language-flag" id="current-flag">
                <span id="current-lang">LT</span>
            </button>
            <div class="language-dropdown" id="language-dropdown">
                <div class="language-option" data-lang="lt">
                    <img src="LT.png" alt="LT" class="language-flag">
                    <span>Lietuvių</span>
                </div>
                <div class="language-option" data-lang="lv">
                    <img src="LV.png" alt="LV" class="language-flag">
                    <span>Latviešu</span>
                </div>
                <div class="language-option" data-lang="ru">
                    <img src="RU.png" alt="RU" class="language-flag">
                    <span>Русский</span>
                </div>
                <div class="language-option" data-lang="en">
                    <img src="UK.png" alt="EN" class="language-flag">
                    <span>English</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <h1 data-translate="reset-title">Keisti slaptažodį</h1>
        <div id="message"></div>

        <form id="reset-form" style="display: none;">
            <div class="form-group">
                <label for="new-password" data-translate="new-password-label">Naujas slaptažodis</label>
                <input type="password" id="new-password" required minlength="6" data-translate="new-password-placeholder" placeholder="Įveskite naują slaptažodį">
            </div>

            <div class="form-group">
                <label for="confirm-password" data-translate="confirm-password-label">Pakartoti slaptažodį</label>
                <input type="password" id="confirm-password" required minlength="6" data-translate="confirm-password-placeholder" placeholder="Pakartokite naują slaptažodį">
            </div>

            <button type="submit" data-translate="reset-button">Keisti slaptažodį</button>
        </form>
    </div>

    <footer>
        <div data-translate="footer">© 2025 Rubineta. Visos teisės saugomos.</div>
        <div class="footer-flags">
            <img src="LT.png" alt="Lietuvių" class="footer-flag" data-lang="lt">
            <img src="LV.png" alt="Latviešu" class="footer-flag" data-lang="lv">
            <img src="RU.png" alt="Русский" class="footer-flag" data-lang="ru">
            <img src="UK.png" alt="English" class="footer-flag" data-lang="en">
        </div>
    </footer>

    <script>
        // Kalbų vertimai
        const translations = {
            lt: {
                "nav-home": "Pagrindinis",
                "nav-login": "Prisijungti",
                "reset-title": "Keisti slaptažodį",
                "new-password-label": "Naujas slaptažodis",
                "new-password-placeholder": "Įveskite naują slaptažodį",
                "confirm-password-label": "Pakartoti slaptažodį",
                "confirm-password-placeholder": "Pakartokite naują slaptažodį",
                "reset-button": "Keisti slaptažodį",
                "footer": "© 2025 Rubineta. Visos teisės saugomos.",
                "invalid-link": "Netinkama nuoroda.",
                "expired-link": "Nuoroda nebegalioja arba yra neteisinga.",
                "passwords-not-match": "Slaptažodžiai nesutampa.",
                "user-not-found": "Vartotojas nerastas.",
                "password-changed": "✅ Slaptažodis sėkmingai pakeistas. Galite <a href='login.html'>prisijungti</a>."
            },
            lv: {
                "nav-home": "Galvenā",
                "nav-login": "Pieslēgties",
                "reset-title": "Mainīt paroli",
                "new-password-label": "Jaunā parole",
                "new-password-placeholder": "Ievadiet jauno paroli",
                "confirm-password-label": "Atkārtot paroli",
                "confirm-password-placeholder": "Atkārtot jauno paroli",
                "reset-button": "Mainīt paroli",
                "footer": "© 2025 Rubineta. Visas tiesības aizsargātas.",
                "invalid-link": "Nederīga saite.",
                "expired-link": "Saite vairs nav derīga vai ir nepareiza.",
                "passwords-not-match": "Paroles nesakrīt.",
                "user-not-found": "Lietotājs nav atrasts.",
                "password-changed": "✅ Parole veiksmīgi mainīta. Jūs varat <a href='login.html'>pieteikties</a>."
            },
            ru: {
                "nav-home": "Главная",
                "nav-login": "Войти",
                "reset-title": "Изменить пароль",
                "new-password-label": "Новый пароль",
                "new-password-placeholder": "Введите новый пароль",
                "confirm-password-label": "Повторите пароль",
                "confirm-password-placeholder": "Повторите новый пароль",
                "reset-button": "Изменить пароль",
                "footer": "© 2025 Rubineta. Все права защищены.",
                "invalid-link": "Неверная ссылка.",
                "expired-link": "Ссылка больше не действительна или неверна.",
                "passwords-not-match": "Пароли не совпадают.",
                "user-not-found": "Пользователь не найден.",
                "password-changed": "✅ Пароль успешно изменен. Вы можете <a href='login.html'>войти</a>."
            },
            en: {
                "nav-home": "Home",
                "nav-login": "Login",
                "reset-title": "Reset Password",
                "new-password-label": "New Password",
                "new-password-placeholder": "Enter new password",
                "confirm-password-label": "Confirm Password",
                "confirm-password-placeholder": "Confirm new password",
                "reset-button": "Reset Password",
                "footer": "© 2025 Rubineta. All rights reserved.",
                "invalid-link": "Invalid link.",
                "expired-link": "Link has expired or is invalid.",
                "passwords-not-match": "Passwords do not match.",
                "user-not-found": "User not found.",
                "password-changed": "✅ Password successfully changed. You can now <a href='login.html'>login</a>."
            }
        };

        // Nustatyti numatytąją kalbą
        let currentLang = localStorage.getItem('language') || 'lt';

        // Atnaujinti kalbos mygtuką
        function updateLanguageButton() {
            const btn = document.getElementById('language-btn');
            const flag = document.getElementById('current-flag');
            const langText = document.getElementById('current-lang');
            
            // Atnaujinti vėliavą ir kalbos kodą
            flag.src = getFlagSrc(currentLang);
            flag.alt = currentLang.toUpperCase();
            langText.textContent = currentLang.toUpperCase();
        }

        // Gauti vėliavos šaltinį pagal kalbą
        function getFlagSrc(lang) {
            switch(lang) {
                case 'lt': return "LT.png";
                case 'lv': return "LV.png";
                case 'ru': return "RU.png";
                case 'en': return "UK.png";
                default: return "LT.png";
            }
        }

        // Pakeisti kalbą
        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            applyTranslations();
            updateLanguageButton();
            document.documentElement.lang = lang;
        }

        // Taikyti vertimus
        function applyTranslations() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLang] && translations[currentLang][key]) {
                    if (element.placeholder !== undefined) {
                        element.placeholder = translations[currentLang][key];
                    } else {
                        element.textContent = translations[currentLang][key];
                    }
                }
            });
        }

        // Patikrinti, ar tokenas galioja
        function isTokenValid(token, email) {
            const resetTokens = JSON.parse(localStorage.getItem('passwordResetTokens') || '{}');
            const saved = resetTokens[token];
            if (!saved) return false;
            if (saved.email !== email) return false;
            if (Date.now() > saved.expires) return false;
            return true;
        }

        // Rodyti pranešimą
        function showMessage(type, key) {
            const messageDiv = document.getElementById('message');
            const message = translations[currentLang]?.[key] || key;
            
            if (type === 'error') {
                messageDiv.innerHTML = `<div class="error">${message}</div>`;
            } else if (type === 'success') {
                messageDiv.innerHTML = `<div class="success">${message}</div>`;
            }
        }

        // Puslapio užkrovimo logika
        document.addEventListener('DOMContentLoaded', function() {
            // Kalbos pasirinkimo funkcionalumas
            const languageBtn = document.getElementById('language-btn');
            const languageDropdown = document.getElementById('language-dropdown');
            
            languageBtn.addEventListener('click', function() {
                languageDropdown.classList.toggle('show');
            });
            
            // Uždaryti kalbų pasirinkimo langą paspaudus už jo ribų
            document.addEventListener('click', function(event) {
                if (!languageBtn.contains(event.target) && !languageDropdown.contains(event.target)) {
                    languageDropdown.classList.remove('show');
                }
            });
            
            // Kalbos pasirinkimas
            const languageOptions = document.querySelectorAll('.language-option');
            languageOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    changeLanguage(lang);
                    languageDropdown.classList.remove('show');
                });
            });
            
            // Kalbos pasirinkimas per footerį
            const footerFlags = document.querySelectorAll('.footer-flag');
            footerFlags.forEach(flag => {
                flag.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    changeLanguage(lang);
                });
            });
            
            // Taikyti vertimus
            applyTranslations();
            updateLanguageButton();
            document.documentElement.lang = currentLang;

            // Slaptažodžio keitimo logika
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const email = urlParams.get('email');

            const messageDiv = document.getElementById('message');
            const resetForm = document.getElementById('reset-form');

            if (!token || !email) {
                showMessage('error', 'invalid-link');
                return;
            }

            if (!isTokenValid(token, email)) {
                showMessage('error', 'expired-link');
                return;
            }

            resetForm.style.display = 'block';

            // Keisti slaptažodį
            document.getElementById('reset-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;

                if (newPassword !== confirmPassword) {
                    showMessage('error', 'passwords-not-match');
                    return;
                }

                // Atnaujinti vartotoją
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.email === email);
                if (!user) {
                    showMessage('error', 'user-not-found');
                    return;
                }

                user.password = newPassword;
                localStorage.setItem('users', JSON.stringify(users));

                // Ištrinti tokeną
                const resetTokens = JSON.parse(localStorage.getItem('passwordResetTokens') || '{}');
                delete resetTokens[token];
                localStorage.setItem('passwordResetTokens', JSON.stringify(resetTokens));

                // Rodyti sėkmę
                resetForm.style.display = 'none';
                showMessage('success', 'password-changed');
            });
        });
    </script>
</body>
</html>

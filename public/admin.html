<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administratoriaus zona – Rubineta</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
               
    <style>
        :root {
            --primary: #2D2D2D;
            --primary-light: #4A4A4A;
            --secondary: #FFCC00;
            --light: #F5F5F5;
            --white: #FFFFFF;
            --dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --border: #E0E0E0;
            --accent: #007cba;
            --shadow: rgba(0,0,0,0.1);
        }

        /* Baziniai stiliai */
        body {
            font-family: 'Roboto', system-ui, -apple-system, Segoe UI, Helvetica, Arial, sans-serif;
            margin: 0;
            background: #fafafa;
            color: #333;
        }
        header {
            background: linear-gradient(180deg, #fff, #f8f9fa);
            border-bottom: 1px solid #eee;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        header h1 {
            margin: 0 0 12px;
            font-weight: 700;
            font-size: 22px;
            color: #111;
        }
        .toolbar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 12px;
        }
        .filters input, .filters select, .filters button {
            padding: 8px 10px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fff;
        }
        .filters button {
            cursor: pointer;
        }
        .btn { border: 1px solid #ccc; background: #fff; cursor: pointer; }
        .btn-primary { background: #007cba; color: #fff; border-color: #007cba; }
        .btn-primary:hover { background: #0a6ea8; }
        .btn-export { background: #28a745; color: #fff; border-color: #28a745; }
        .btn-export:hover { background: #23923d; }
        .muted { color: #666; }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        /* Lentelė */
        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 1px 4px var(--shadow);
        }
        thead th {
            background: #f6f7fb;
            color: #333;
            border-bottom: 1px solid #eee;
            padding: 10px;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
        }
        tbody td {
            border-top: 1px solid #f0f0f0;
            padding: 8px 10px;
            vertical-align: top;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        tbody tr:nth-child(even){ background: #fafafa; }
        tbody tr:hover{ background: #f3f6ff; }

        .status-dropdown { padding: 6px 8px; border-radius: 6px; }
        .status-new { background: #eef; }
        .status-pending { background: #fff3cd; }
        .status-approved { background: #d1e7dd; }
        .status-sent { background: #e7e3ff; }
        .status-resolved { background: #d1e7dd; }
        .status-rejected { background: #f8d7da; }

        .dropdown-status-filter{position:relative;display:inline-block}
        #status-dropdown{position:absolute;top:100%;left:0;z-index:10;background:#fff;border:1px solid #ccc;border-radius:6px;padding:8px;display:none;min-width:240px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
        #status-dropdown label{display:flex;align-items:center;gap:6px;padding:4px 2px;font-size:13px}

        .pill {
            display: inline-block;
            padding: 4px 10px;
            border: 1px solid #ddd;
            border-radius: 999px;
            background: #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,.04);
        }

        .section {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,.06);
        }

        .section h2 {
            margin: 0 0 10px;
            font-size: 18px;
        }

        /* Skirtukai */
        .tabs {
            display: flex;
            margin-bottom: 15px;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .tab {
            padding: 8px 16px;
            background: #e9ecef;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
     
        }
        .tab.active {
            background: #fff;
            border: 1px solid #ddd;
            border-bottom: none;
        }

        .btn-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
        }

        .btn-link:hover {
            background: #f7f7f7;
        }
    </style>
</head>
<body>
    <header>
        <h1>Administratoriaus zona – pretenzijos</h1>

        <div class="filters">
            <input type="text" id="filter-product" placeholder="Produkto pavadinimas">
            <input type="text" id="filter-city" placeholder="Miestas">
            <input type="date" id="filter-date-from">
            <input type="date" id="filter-date-to">
            <button onclick="exportToCSV()" class="btn btn-export">Eksportuoti į CSV</button>
            <button onclick="exportToXLS()" class="btn btn-export">Eksportuoti į Excel</button>
        </div>

        <div class="toolbar">
            <span class="pill">Įrašų iš viso: <strong id="total-claims">0</strong></span>
        </div>
    </header>

    <main>
        <div class="section">
            <!-- Pretenzijų lentelė -->
            <table id="claims-table">
                <thead>
                    <tr>
                        <th style="width: 8%;">ID</th>
                        <th style="width: 8%;">Data</th>
                        <th style="width: 10%;">Vartotojas</th>
                        <th style="width: 8%;">Miestas</th>
                        <th style="width: 10%;">Produktas</th>
                        <th style="width: 12%;">Problema</th>
                        <th style="width: 10%;">Meistras</th>
                        <th style="width: 8%;">Būsena</th>
                        <th style="width: 10%;">Atsakingas</th>
                        <th style="width: 10%;">Koment</th>
                        <th style="width: 10%;">Remonto kaštai (EUR)</th>
                    </tr>
                </thead>
                <tbody id="claims-body">
                    <tr><td colspan="10" style="text-align: center;">Kraunama...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Skirtukas: Vartotojas, Partneriai... (palikta kaip buvo tavo faile) -->
    </main>

    <script>
        /* ------ Tavo esamas kodas iki eksportų ir render funkcijų ------ */

        function exportToCSV() {
            const all = JSON.parse(localStorage.getItem('claims') || '[]');
            const headers = ['ID','Data','Vardas','Pavardė','El. paštas','Telefonas','Produktas','Aprašymas','Būsena','Miestas','Priskirtas meistras','Komentaras','Remonto kaštai (EUR)'];
            const rows = all.map(c => [
                c.id,
                new Date(c.date).toLocaleDateString('lt-LT'),
                c.contact?.name || '',
                c.contact?.surname || '',
                c.contact?.email || '',
                c.contact?.phone || '',
                c.product || '',
                (c.description || '').replace(/"/g,'""'),
                c.status || '',
                c.contact?.city || '',
                c.assignedPartner || '',
                (c.qualityComment || '').replace(/"/g,'""'),
                (typeof c.repairCost === 'number' ? c.repairCost.toFixed(2) : (c.repairCost || ''))
            ].join(';'));
            const csv = [headers.join(';'), ...rows].join('\n');
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'pretenzijos.csv';
            document.body.appendChild(a); a.click();
            setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); },0);
        }

        function exportToXLS() {
            const claims = JSON.parse(localStorage.getItem('claims') || '[]');
            const esc = s => String(s ?? '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
            const headers = ['ID','Data','Vartotojas','Miestas','Produktas','Problema','Meistras','Būsena','Atsakingas','Koment','Remonto kaštai (EUR)'];
            const rowsHtml = claims.map(c => `
                <tr>
                  <td>${esc(c.id)}</td>
                  <td>${esc(new Date(c.date).toLocaleDateString('lt-LT'))}</td>
                  <td>${esc((c.contact?.name||'')+' '+(c.contact?.surname||''))}</td>
                  <td>${esc(c.contact?.city||'')}</td>
                  <td>${esc(c.product||'')}</td>
                  <td>${esc(c.description||'')}</td>
                  <td>${esc(c.assignedPartner||'')}</td>
                  <td>${esc(c.status||'')}</td>
                  <td>${esc(c.responsible||'')}</td>
                  <td>${esc(c.qualityComment||'')}</td>
                  <td>${typeof c.repairCost==='number'?c.repairCost.toFixed(2):esc(c.repairCost||'')}</td>
                </tr>`).join('');
            const table = `<table border="1"><thead><tr>${headers.map(h=>`<th>${esc(h)}</th>`).join('')}</tr></thead><tbody>${rowsHtml}</tbody></table>`;
            const html = `<!DOCTYPE html><html><head><meta charset="utf-8"></head><body>${table}</body></html>`;
            const blob = new Blob([html], {type:'application/vnd.ms-excel;charset=utf-8;'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'pretenzijos.xls';
            document.body.appendChild(a); a.click();
            setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); },0);
        }

        /* ---- Tavo esamas kodas: getStatusClass, updateStatusDirectly, loadClaims ir pan. ---- */

        function saveRepairCost(id, raw) {
            const claims = JSON.parse(localStorage.getItem('claims') || '[]');
            const claim = claims.find(c => c.id === id);
            if (!claim) return;
            const v = String(raw ?? '').replace(',', '.').trim();
            const num = v === '' ? '' : Number(v);
            if (v !== '' && (!isFinite(num) || num < 0)) {
                alert('Įveskite teisingą sumą (pvz., 25.50)');
                return;
            }
            claim.repairCost = (v === '' ? '' : Number(num.toFixed(2)));
            localStorage.setItem('claims', JSON.stringify(claims));
        }

        function getStatusClass(status) {
            switch (status) {
                case 'Nauja': return 'new';
                case 'Laukia patvirtinimo': return 'pending';
                case 'Patvirtinta': return 'approved';
                case 'Perduota servisui': return 'sent';
                case 'Išspręsta': return 'resolved';
                case 'Atmesta': return 'rejected';
                default: return 'new';
            }
        }

        /* Tavo loadClaims – paliktas, tik įterptas naujas stulpelis su įvedimu */
        function loadClaims(filteredClaims = null) {
            const claims = filteredClaims || JSON.parse(localStorage.getItem('claims') || '[]');
            const tbody = document.getElementById('claims-body');
            tbody.innerHTML = '';

            claims.forEach(claim => {
                const masterCell = claim.assignedPartner 
                    ? `<span>${claim.assignedPartner}</span>` 
                    : `<button class="btn btn-primary" onclick="showAssignModal('${claim.id}')">Priskirti meistrui</button>`;

                const responsibleCell = claim.responsible 
                    ? `<a href="#" onclick="event.preventDefault(); showResponsibleModal('${claim.id}');">${claim.responsible}</a>`
                    : `<a href="#" onclick="event.preventDefault(); showResponsibleModal('${claim.id}');">Paskirti atsakingą</a>`;

                const commentCell = claim.qualityComment || '-------';

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><a href="#" onclick="event.preventDefault(); viewClaimDetails('${claim.id}');">${claim.id}</a></td>
                    <td>${new Date(claim.date).toLocaleDateString('lt-LT')}</td>
                    <td>${claim.contact.name} ${claim.contact.surname}</td>
                    <td>${claim.contact.city}</td>
                    <td>${claim.product}</td>
                    <td>${(claim.description||'').substring(0, 30)}...</td>
                    <td>${masterCell}</td>
                    <td>
                        <select class="status-dropdown status-${getStatusClass(claim.status)}" onchange="updateStatusDirectly('${claim.id}', this.value)">
                            <option value="Nauja" ${claim.status === 'Nauja' ? 'selected' : ''}>Nauja</option>
                            <option value="Laukia patvirtinimo" ${claim.status === 'Laukia patvirtinimo' ? 'selected' : ''}>Laukia patvirtinimo</option>
                            <option value="Patvirtinta" ${claim.status === 'Patvirtinta' ? 'selected' : ''}>Patvirtinta</option>
                            <option value="Perduota servisui" ${claim.status === 'Perduota servisui' ? 'selected' : ''}>Perduota servisui</option>
                            <option value="Išspręsta" ${claim.status === 'Išspręsta' ? 'selected' : ''}>Išspręsta</option>
                            <option value="Atmesta" ${claim.status === 'Atmesta' ? 'selected' : ''}>Atmesta</option>
                        </select>
                    </td>
                    <td>${responsibleCell}</td>
                    <td>${commentCell}</td>
                    <td>
                        <input type="number" step="0.01" min="0" 
                               value="${typeof claim.repairCost === 'number' ? claim.repairCost.toFixed(2) : (claim.repairCost || '')}"
                               placeholder="0.00" style="width:100%;padding:4px;text-align:right"
                               onblur="saveRepairCost('${claim.id}', this.value)" />
                    </td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById('total-claims').textContent = claims.length;
        }

        /* ---- Likęs tavo kodas (partneriai, modalai, el. laiškas ir pan.) paliekamas kaip buvo ---- */
    </script>
</body>
</html>

























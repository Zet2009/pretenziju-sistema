<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <title>Mano kabinetas – Rubineta</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2D2D2D; --light: #F5F5F5; }
        body { font-family: 'Roboto', sans-serif; background: var(--light); padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: var(--primary); color: white; }
        .btn { padding: 5px 10px; background: #007BFF; color: white; text-decoration: none; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Sveiki, <span id="user-name"></span>!</h1>
    <div class="stats" style="display:flex; gap: 20px; margin: 20px 0;">
        <div>Viso: <strong id="total-claims">0</strong></div>
        <div>Atviros: <strong id="open-claims">0</strong></div>
        <div>Išspręstos: <strong id="resolved-claims">0</strong></div>
    </div>

    <h2>Jūsų pretenzijos</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Produktas</th>
                <th>Būsena</th>
                <th>Data</th>
                <th>Veiksmas</th>
            </tr>
        </thead>
        <tbody id="claims-body">
            <tr><td colspan="5" style="text-align: center;">Kraunama...</td></tr>
        </tbody>
    </table>

    <script>

// dashboard.html
const currentUser = JSON.parse(localStorage.getItem('currentUser'));

if (!currentUser) {
    // Nustatyti, kad po prisijungimo grįžtume čia
    localStorage.setItem('redirectUrl', 'dashboard.html');
    alert('Prisijunkite, kad peržiūrėti kabinetą.');
    location.href = 'login.html';
}
        document.getElementById('user-name').textContent = currentUser.name;

        function loadUserClaims() {
            const claims = JSON.parse(localStorage.getItem('claims') || '[]');
            const userClaims = claims.filter(c => c.userId === currentUser.id);

            const tbody = document.getElementById('claims-body');
            tbody.innerHTML = '';

            let openCount = 0, resolvedCount = 0;

            if (userClaims.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Jūs dar nepateikėte pretenzijų.</td></tr>';
            } else {
                userClaims.forEach(claim => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${claim.id}</td>
                        <td>${claim.product}</td>
                        <td>${claim.status}</td>
                        <td>${new Date(claim.date).toLocaleDateString('lt-LT')}</td>
                        <a href="claim-user.html?id=${claim.id}&role=customer">Peržiūrėti</a>
                    `;
                    tbody.appendChild(tr);

                    if (claim.status === 'Išspręsta') resolvedCount++;

                    else openCount++;
                });
            }

            document.getElementById('total-claims').textContent = userClaims.length;
            document.getElementById('open-claims').textContent = openCount;
            document.getElementById('resolved-claims').textContent = resolvedCount;
        }

        loadUserClaims();
    </script>
</body>
</html>
